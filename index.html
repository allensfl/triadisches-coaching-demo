<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triadisches Coaching Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.6;
        }

        .demo-notice {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 15px 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #e17055;
        }

        .demo-notice h3 {
            color: #d63031;
            margin-bottom: 10px;
        }

        .demo-notice p {
            color: #2d3436;
            margin-bottom: 8px;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: bold;
            z-index: 1000;
            background: #e74c3c;
            color: white;
        }

        .api-status.connected {
            background: #27ae60;
        }

        .client-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .client-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .client-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .client-card.selected {
            border-color: #667eea !important;
            background: rgba(102, 126, 234, 0.1) !important;
            transform: translateY(-3px) !important;
        }

        .client-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .client-card .age {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .client-card .challenge {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
            color: #d63031;
        }

        .client-card .background {
            color: #666;
            line-height: 1.5;
            font-size: 0.95em;
        }

        .start-button {
            background: rgba(108, 117, 125, 0.3);
            color: rgba(108, 117, 125, 0.7);
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: not-allowed;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            font-weight: bold;
            opacity: 0.5;
        }

        .start-button.active {
            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
            color: white !important;
            cursor: pointer !important;
            opacity: 1 !important;
            transform: scale(1.05) !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3) !important;
        }

        .start-button:hover.active {
            transform: scale(1.08) !important;
        }

        .dashboard {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .client-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .client-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
        }

        .session-controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .coaching-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .step {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #ddd;
        }

        .step:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: #667eea;
            transform: translateX(5px);
        }

        .step.active {
            background: rgba(102, 126, 234, 0.15);
            border-left-color: #667eea;
        }

        .step h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .step p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .coach-tools {
            background: rgba(255, 248, 220, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #f39c12;
        }

        .coach-tools h4 {
            color: #d68910;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .tool-item {
            background: rgba(243, 156, 18, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #d68910;
            font-weight: 500;
        }

        .chat-interface {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .chat-main {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            min-height: 400px;
        }

        .chat-sidebar {
            background: rgba(255, 248, 220, 0.9);
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid #f39c12;
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 10px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            max-width: 80%;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .message.ai {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid #27ae60;
            color: #27ae60;
        }

        .message.coach {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid #f39c12;
            color: #d68910;
        }

        .typing-indicator {
            display: none;
            color: #888;
            font-style: italic;
            margin-bottom: 15px;
        }

        .typing-indicator.show {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s ease;
            resize: vertical;
        }

        .form-group textarea:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .variable-inputs {
            background: rgba(102, 126, 234, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .variable-inputs h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .ai-response {
            background: rgba(39, 174, 96, 0.05);
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
        }

        .ai-response h4 {
            color: #27ae60;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-response-content {
            color: #333;
            line-height: 1.6;
            font-size: 1.05em;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-style: italic;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
        }

        .screen-sharing-notice {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .session-timer {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .client-selection {
                grid-template-columns: 1fr;
            }

            .coaching-steps {
                grid-template-columns: 1fr;
            }

            .chat-interface {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        .debug-info {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
            color: #cc0000;
        }
    </style>
</head>
<body>
    <div id="apiStatus" class="api-status">🔴 API Status: Nicht verbunden</div>
    
    <div class="container">
        <div class="header">
            <h1>🤖 Triadisches Coaching Demo</h1>
            <p>Erleben Sie innovative KI-unterstützte Coaching-Sessions mit dem revolutionären Coach + Klient + KI System</p>
            
            <div class="demo-notice">
                <h3>💡 Wichtiger Hinweis zum echten Coaching-Prozess:</h3>
                <p><strong>🗣️ Live-Coaching läuft mündlich ab:</strong> Echte Coaching-Sessions finden über Zoom oder persönlich statt. Der Coach führt ein normales Gespräch mit dem Klienten.</p>
                <p><strong>🤖 KI-Integration im Hintergrund:</strong> Während des Gesprächs fasst der Coach wichtige Aussagen des Klienten in Prompts zusammen und sendet diese an die KI. Beide betrachten die KI-Antwort gemeinsam am geteilten Bildschirm.</p>
                <p><strong>👥 Kollaborativer Prozess:</strong> Klient und Coach diskutieren die KI-Hinweise gemeinsam und passen diese bei Bedarf an - echte Teamarbeit zu dritt!</p>
                <p><strong>📺 Diese Demo zeigt:</strong> Den beispielhaften Workflow und die praktische KI-Integration, die das Live-Coaching so kraftvoll macht.</p>
            </div>
        </div>

        <!-- Klient-Auswahl -->
        <div id="clientSelection">
            <h2 style="text-align: center; margin-bottom: 30px; color: white;">Wählen Sie einen Klienten für die Demo-Session:</h2>
            
            <div class="client-selection">
                <div class="client-card" data-client="sarah" onclick="selectClient('sarah')">
                    <h3>Sarah Weber</h3>
                    <div class="age">35 Jahre • Karrierewechsel</div>
                    <div class="challenge">🎯 Berufliche Neuorientierung nach 10 Jahren im Marketing</div>
                    <div class="background">
                        Sarah ist eine erfahrene Marketing-Managerin, die sich nach einem erfüllenderem Beruf sehnt. 
                        Sie möchte in den Bereich Nachhaltigkeit wechseln, ist aber unsicher über die praktischen Schritte 
                        und hat Angst vor finanziellen Einbußen. Sie sucht nach Klarheit über ihre wahren Stärken und 
                        einem realistischen Übergangsplan.
                    </div>
                </div>

                <div class="client-card" data-client="marcus" onclick="selectClient('marcus')">
                    <h3>Marcus Hoffmann</h3>
                    <div class="age">48 Jahre • Midlife-Crisis</div>
                    <div class="challenge">🔄 Sinnkrise und Zweifel an bisherigen Lebensentscheidungen</div>
                    <div class="background">
                        Marcus ist ein erfolgreicher Ingenieur, der trotz äußerem Erfolg eine tiefe Unzufriedenheit 
                        verspürt. Er hinterfragt seine Karriere, seine Ehe und seine Lebensziele. Die Kinder sind 
                        ausgezogen und er fragt sich "War das schon alles?". Er sucht nach neuem Sinn und 
                        Lebensfreude in der zweiten Lebenshälfte.
                    </div>
                </div>

                <div class="client-card" data-client="lisa" onclick="selectClient('lisa')">
                    <h3>Lisa Müller</h3>
                    <div class="age">42 Jahre • Work-Life-Balance</div>
                    <div class="challenge">⚖️ Überforderung zwischen Karriere als Chirurgin und Familienleben</div>
                    <div class="background">
                        Lisa ist eine leidenschaftliche Chirurgin mit zwei Kindern. Sie arbeitet 60-70 Stunden pro Woche 
                        und sieht ihre Kinder nur abends kurz. Sie liebt ihren Beruf, aber die Familie leidet darunter. 
                        Erste Burnout-Symptome machen sich bemerkbar. Sie sucht nach Wegen, beiden Lebensbereichen 
                        gerecht zu werden, ohne einen davon aufgeben zu müssen.
                    </div>
                </div>

                <div class="client-card" data-client="werner" onclick="selectClient('werner')">
                    <h3>Werner Schmidt</h3>
                    <div class="age">63 Jahre • Ruhestand</div>
                    <div class="challenge">🎭 Angst vor dem Ruhestand und Verlust der beruflichen Identität</div>
                    <div class="background">
                        Werner war 40 Jahre lang ein respektierter Abteilungsleiter in einem Maschinenbauunternehmen. 
                        In zwei Jahren geht er in Rente und hat große Ängste vor dieser Lebensphase. "Wer bin ich ohne 
                        meinen Beruf?" ist seine zentrale Frage. Er braucht Unterstützung beim Übergang und der 
                        Entwicklung einer neuen, erfüllenden Lebensphase.
                    </div>
                </div>
            </div>

            <button id="startButton" class="start-button" onclick="startSession()">
                🚀 Klient auswählen
            </button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <div class="client-info">
                    <div id="clientAvatar" class="client-avatar">SW</div>
                    <div>
                        <h2 id="clientName">Sarah Weber</h2>
                        <p id="clientChallenge" style="color: #666;">Karrierewechsel • 35 Jahre</p>
                    </div>
                </div>
                <div class="session-controls">
                    <button class="btn btn-secondary" onclick="shareScreen()">📺 Bildschirm teilen</button>
                    <button class="btn btn-primary" onclick="exportSession()">💾 Session exportieren</button>
                    <button class="btn btn-secondary" onclick="endSession()">❌ Session beenden</button>
                </div>
            </div>

            <div class="session-timer">
                <div class="timer-display" id="sessionTimer">00:00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="coaching-steps">
                <div class="step" data-step="1" onclick="selectStep(1)">
                    <h4>1. Zieldefinition</h4>
                    <p>Klares, messbares Coaching-Ziel gemeinsam entwickeln</p>
                </div>
                <div class="step" data-step="2" onclick="selectStep(2)">
                    <h4>2. Situationsanalyse</h4>
                    <p>Aktuelle Situation und Herausforderungen erfassen</p>
                </div>
                <div class="step" data-step="3" onclick="selectStep(3)">
                    <h4>3. Vision entwickeln</h4>
                    <p>Kraftvolle Zukunftsvision als Orientierung schaffen</p>
                </div>
                <div class="step" data-step="4" onclick="selectStep(4)">
                    <h4>4. Hindernisse identifizieren</h4>
                    <p>Innere und äußere Blockaden bewusst machen</p>
                </div>
                <div class="step" data-step="5" onclick="selectStep(5)">
                    <h4>5. Ressourcen aktivieren</h4>
                    <p>Stärken, Fähigkeiten und Unterstützung mobilisieren</p>
                </div>
                <div class="step" data-step="6" onclick="selectStep(6)">
                    <h4>6. Innere Anteile</h4>
                    <p>Verschiedene Persönlichkeitsaspekte integrieren</p>
                </div>
                <div class="step" data-step="7" onclick="selectStep(7)">
                    <h4>7. Lösungsstrategien</h4>
                    <p>Konkrete Handlungsoptionen entwickeln</p>
                </div>
                <div class="step" data-step="8" onclick="selectStep(8)">
                    <h4>8. Entscheidungsfindung</h4>
                    <p>Beste Lösung auswählen und priorisieren</p>
                </div>
                <div class="step" data-step="9" onclick="selectStep(9)">
                    <h4>9. Maßnahmenplanung</h4>
                    <p>Detaillierte Schritte und Timeline festlegen</p>
                </div>
                <div class="step" data-step="10" onclick="selectStep(10)">
                    <h4>10. Erfolgsmetriken</h4>
                    <p>Messbare Indikatoren für Fortschritt definieren</p>
                </div>
                <div class="step" data-step="11" onclick="selectStep(11)">
                    <h4>11. Risikomanagement</h4>
                    <p>Mögliche Hindernisse antizipieren und Gegenmaßnahmen</p>
                </div>
                <div class="step" data-step="12" onclick="selectStep(12)">
                    <h4>12. Commitment</h4>
                    <p>Verbindliche Vereinbarungen und nächste Schritte</p>
                </div>
            </div>

            <div id="coachTools" class="coach-tools">
                <h4>🛠️ Coach-Techniken für aktuellen Schritt</h4>
                <div id="currentTools" class="tool-grid">
                    <div class="tool-item">Zirkuläre Fragen</div>
                    <div class="tool-item">Externalisierung</div>
                    <div class="tool-item">Zielcollage</div>
                </div>
                <button class="btn btn-primary" style="margin-top: 15px;" onclick="openPromptEditor()">
                    ✏️ Prompt bearbeiten
                </button>
            </div>

            <div class="chat-interface">
                <div class="chat-main">
                    <h3 style="margin-bottom: 20px; color: #667eea;">💬 Beispielhafter Dialog</h3>
                    <div id="chatMessages" class="chat-messages">
                        <div class="message coach">
                            <strong>Coach:</strong> Willkommen zur heutigen Session! Wie geht es Ihnen heute?
                        </div>
                    </div>
                    <div id="typingIndicator" class="typing-indicator">
                        KI analysiert und gibt Impulse...
                    </div>
                </div>

                <div class="chat-sidebar">
                    <h4 style="color: #d68910; margin-bottom: 15px;">🎯 KI-Coach Hinweise</h4>
                    <div id="coachInstructions" style="color: #d68910; line-height: 1.6;">
                        <p><strong>Aktuelle Phase:</strong> Beziehungsaufbau und Vertrauen schaffen</p>
                        <p><strong>Empfehlung:</strong> Aktives Zuhören, Empathie zeigen, offene Fragen stellen</p>
                        <p><strong>Achtung:</strong> Nicht zu schnell in Lösungen gehen, erstmal verstehen</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div id="promptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✏️ KI-Prompt Bearbeitung - Kollaborativ mit Klient</h2>
                <span class="close" onclick="closePromptEditor()">&times;</span>
            </div>
            
            <div class="screen-sharing-notice">
                📺 Screen-Sharing aktiv: Klient sieht dieses Fenster mit!
            </div>

            <div class="form-group">
                <label for="promptText">Prompt für KI-Assistent:</label>
                <textarea id="promptText" rows="4" placeholder="Beschreiben Sie, was die KI analysieren soll...">Als erfahrener Coach-Assistent: Analysiere das Hauptproblem '[PROBLEMBESCHREIBUNG]' mit Kontext '[DETAILS]'. Entwickle präzise Fragen, um ein klares, messbares Coaching-Ziel zu formulieren. Berücksichtige emotionale und praktische Aspekte.</textarea>
            </div>

            <div class="variable-inputs">
                <h4>🔧 Variablen aus dem Live-Coaching:</h4>
                <div class="form-group">
                    <label for="problemDescription">[PROBLEMBESCHREIBUNG]:</label>
                    <input type="text" id="problemDescription" placeholder="Was beschreibt der Klient als Hauptproblem?">
                </div>
                <div class="form-group">
                    <label for="details">[DETAILS]:</label>
                    <input type="text" id="details" placeholder="Welche Details und Kontext-Infos gibt der Klient?">
                </div>
                <div class="form-group">
                    <label for="context">[KONTEXT]:</label>
                    <input type="text" id="context" placeholder="Weitere wichtige Rahmenbedingungen?">
                </div>
            </div>

            <div class="loading" id="promptLoading">
                🤖 KI analysiert die Situation...
            </div>

            <div class="ai-response" id="aiResponse" style="display: none;">
                <h4>🤖 KI-Response für Klient:</h4>
                <div id="aiResponseContent" class="ai-response-content">
                    Hier erscheint die KI-Antwort...
                </div>
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="sendToAI()" style="font-size: 1.1em; padding: 12px 30px;">
                    🚀 An KI senden
                </button>
                <button class="btn btn-secondary" onclick="closePromptEditor()" style="margin-left: 15px;">
                    Schließen
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedClient = null;
        let currentStep = 1;
        let sessionStartTime = null;
        let sessionTimer = null;

        // Debug-Logging
        console.log('Initializing app...');

        const clients = {
            sarah: {
                name: "Sarah Weber",
                age: "35 Jahre",
                challenge: "Karrierewechsel",
                background: "Erfahrene Marketing-Managerin, die sich nach einem erfüllenderem Beruf im Bereich Nachhaltigkeit sehnt.",
                avatar: "SW"
            },
            marcus: {
                name: "Marcus Hoffmann", 
                age: "48 Jahre",
                challenge: "Midlife-Crisis",
                background: "Erfolgreicher Ingenieur mit tiefer Unzufriedenheit trotz äußerem Erfolg.",
                avatar: "MH"
            },
            lisa: {
                name: "Lisa Müller",
                age: "42 Jahre", 
                challenge: "Work-Life-Balance",
                background: "Leidenschaftliche Chirurgin mit Kindern, die zwischen Karriere und Familie balanciert.",
                avatar: "LM"
            },
            werner: {
                name: "Werner Schmidt",
                age: "63 Jahre",
                challenge: "Ruhestand",
                background: "Langjähriger Abteilungsleiter mit Angst vor dem Ruhestand und Verlust der beruflichen Identität.",
                avatar: "WS"
            }
        };

        const stepTools = {
            1: [
                "Zirkuläre Fragen", "Externalisierung", "Zielcollage", 
                "SMART-Kriterien", "Werte-Klärung", "Vision Board",
                "Ressourcen-Exploration", "Erste Erfolgs-Anker"
            ],
            2: [
                "Aktives Spiegeln", "Gefühls-Landkarte", "Lebensrad", 
                "Systemische Fragen", "Problem-Externalisierung", "Timeline-Arbeit"
            ],
            3: [
                "Wunderfrage", "Zukunftsvision", "Visions-Board",
                "Best-Case-Scenario", "Idealer Tag", "Wertekompass"
            ],
            4: [
                "Hindernis-Analyse", "Glaubenssatz-Check", "Saboteur-Identifikation",
                "Systemische Hindernisse", "Angst-Exploration", "Blockaden-Mapping"
            ],
            5: [
                "Stärken-Inventur", "Erfolgsgeschichten", "Energie-Quellen",
                "Ressourcen-Einsatz", "Potentiale aktivieren", "Bewältigungsstrategien",
                "Unterstützungsnetzwerk", "Überwindungsstrategien"
            ],
            6: [
                "Innere Anteile", "Avatar-Interview", "Rollenwechsel",
                "Zukunfts-Ich Dialog", "Innerer Kritiker", "Weiser Ratgeber",
                "Systemische Anteile", "Familiäre Stimmen"
            ],
            7: [
                "Brainstorming", "Pro-Contra-Liste", "Optionen-Matrix",
                "Kreative Lösungsfindung", "Alternative Wege", "Out-of-the-box"
            ],
            8: [
                "Entscheidungsmatrix", "Kopf-Bauch-Check", "Pro-Contra Plus",
                "Werte-Abgleich", "Konsequenz-Analyse", "Intuitions-Check"
            ],
            9: [
                "SMART-Ziele", "Meilenstein-Planung", "Aktionsplan",
                "Bauchgefühl-Check", "Weiser Ratgeber", "Entscheidungs-Ritual",
                "Timeline", "Ressourcen-Planung", "Erfolgsindikatoren"
            ],
            10: [
                "KPI-Definition", "Messbare Indikatoren", "Erfolgs-Tracking",
                "Fortschritts-Monitoring", "Feedback-Schleifen", "Anpassungszyklen"
            ],
            11: [
                "Risiko-Matrix", "Worst-Case-Analyse", "Plan B entwickeln", 
                "Präventivmaßnahmen", "Notfallpläne", "Flexibilitäts-Puffer"
            ],
            12: [
                "Commitment-Ritual", "Verbindlichkeit schaffen", "Accountability-Partner",
                "Follow-up-Termine", "Erfolgskontrolle", "Nachhaltigkeit sichern"
            ]
        };

        function selectClient(clientId) {
            console.log(`Client card clicked: ${clientId}`);
            selectedClient = clientId;
            console.log(`Selecting client: ${clientId}`);
            
            const availableClients = Object.keys(clients);
            console.log(`Available clients:`, availableClients);
            
            const clientData = clients[clientId];
            console.log(`Client data:`, clientData);
            
            // Entferne active Klasse von allen Karten
            const allCards = document.querySelectorAll('.client-card');
            console.log(`Found cards for deselection:`, allCards.length);
            allCards.forEach(card => card.classList.remove('selected'));
            
            // Füge active Klasse zur gewählten Karte hinzu
            const selectedCard = document.querySelector(`[data-client="${clientId}"]`);
            console.log(`Found selected card:`, selectedCard);
            
            if (selectedCard) {
                selectedCard.classList.add('selected');
                console.log(`Client card selected: ${clientId}`);
            }
            
            // Globale Variable setzen
            window.selectedClient = clientId;
            console.log(`Global selectedClient set to:`, window.selectedClient);
            
            // Start-Button aktivieren
            const startButton = document.getElementById('startButton');
            console.log(`Found start button:`, startButton);
            
            if (startButton && clientData) {
                startButton.textContent = `🚀 Session mit ${clientData.name} starten`;
                startButton.classList.add('active');
                startButton.disabled = false;
                console.log(`Start button activated with text: ${startButton.textContent}`);
                console.log(`Start button classes:`, startButton.className);
            } else {
                console.error(`Start button or client data not found!`);
            }
        }

        function startSession() {
            console.log('Starting session...');
            if (!selectedClient) {
                console.error('No client selected!');
                alert('Bitte wählen Sie zuerst einen Klienten aus.');
                return;
            }

            console.log(`Starting session for client: ${selectedClient}`);
            
            const clientData = clients[selectedClient];
            
            // UI umschalten
            document.getElementById('clientSelection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Client-Daten im Dashboard setzen
            document.getElementById('clientAvatar').textContent = clientData.avatar;
            document.getElementById('clientName').textContent = clientData.name;
            document.getElementById('clientChallenge').textContent = `${clientData.challenge} • ${clientData.age}`;
            
            // Session-Timer starten
            sessionStartTime = Date.now();
            startSessionTimer();
            
            // Ersten Schritt aktivieren
            selectStep(1);
            
            console.log('Session started successfully!');
        }

        function selectStep(stepNum) {
            currentStep = stepNum;
            
            // Schritt-Hervorhebung
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.querySelector(`[data-step="${stepNum}"]`).classList.add('active');
            
            // Tools für aktuellen Schritt aktualisieren
            updateCoachTools(stepNum);
            
            // Progress aktualisieren
            updateProgress(stepNum);
        }

        function updateCoachTools(stepNum) {
            const tools = stepTools[stepNum] || ["Allgemeine Coaching-Techniken"];
            const toolsContainer = document.getElementById('currentTools');
            
            toolsContainer.innerHTML = tools.map(tool => 
                `<div class="tool-item">${tool}</div>`
            ).join('');
        }

        function updateProgress(stepNum) {
            const progress = (stepNum / 12) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function startSessionTimer() {
            sessionTimer = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function openPromptEditor() {
            document.getElementById('promptModal').style.display = 'block';
            
            // Beispiel-Daten setzen basierend auf Klient
            const clientData = clients[selectedClient];
            if (selectedClient === 'lisa') {
                document.getElementById('problemDescription').value = "Die Balance zwischen Karriere als Chirurgin und Familie wird immer schwieriger";
                document.getElementById('details').value = "60-70 Stunden Wochen, Kinder sehe ich nur abends kurz";
                document.getElementById('context').value = "Liebe meinen Beruf, will ihn nicht aufgeben, aber Familie leidet";
            }
        }

        function closePromptEditor() {
            document.getElementById('promptModal').style.display = 'none';
            document.getElementById('aiResponse').style.display = 'none';
            document.getElementById('promptLoading').classList.remove('show');
        }

        async function sendToAI() {
            console.log('Sending to AI...');
            
            const promptText = document.getElementById('promptText').value;
            const problemDescription = document.getElementById('problemDescription').value;
            const details = document.getElementById('details').value;
            const context = document.getElementById('context').value;
            
            // Loading anzeigen
            document.getElementById('promptLoading').classList.add('show');
            document.getElementById('aiResponse').style.display = 'none';
            
            // API Status aktualisieren
            document.getElementById('apiStatus').textContent = '🟡 API Status: Verbinde...';
            
            try {
                const response = await fetch('/api/coaching-ai', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: promptText,
                        step: currentStep,
                        client: selectedClient,
                        variables: {
                            PROBLEMBESCHREIBUNG: problemDescription,
                            DETAILS: details,
                            KONTEXT: context
                        }
                    }),
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('apiStatus').textContent = '🟢 API Status: OpenAI verbunden';
                    document.getElementById('apiStatus').classList.add('connected');
                    
                    // Echte AI Response anzeigen
                    document.getElementById('aiResponseContent').innerHTML = data.response;
                } else {
                    throw new Error(`API Error: ${response.status}`);
                }
            } catch (error) {
                console.error('AI API Error:', error);
                document.getElementById('apiStatus').textContent = '🔴 API Status: Fallback aktiv';
                
                // Intelligente Fallback-Response
                const clientData = clients[selectedClient];
                const fallbackResponse = generateIntelligentFallback(clientData, problemDescription, details, context);
                document.getElementById('aiResponseContent').innerHTML = fallbackResponse;
            }
            
            // Loading verstecken, Response zeigen
            document.getElementById('promptLoading').classList.remove('show');
            document.getElementById('aiResponse').style.display = 'block';
        }

        function generateIntelligentFallback(clientData, problem, details, context) {
            const responses = {
                sarah: `
                    <p><strong>Liebe Frau Weber,</strong></p>
                    <p>vielen Dank für Ihr Vertrauen, diese wichtigen Gedanken zu teilen. Ich höre aus Ihren Worten eine klare Sehnsucht nach mehr Sinnhaftigkeit in Ihrer Arbeit - das zeigt Ihre Weitsicht und Ihren Mut zur Veränderung.</p>
                    <p><strong>Ihre Stärken, die ich erkenne:</strong> 10 Jahre Marketing-Erfahrung sind ein enormer Schatz! Sie haben bewiesen, dass Sie Projekte erfolgreich leiten können, und Ihr Wunsch nach Nachhaltigkeit zeigt Ihre Zukunftsorientierung.</p>
                    <p><strong>Erste Fragen zum Erkunden:</strong> Was genau zieht Sie am Nachhaltigkeitsbereich am meisten an? Welche Ihrer Marketing-Fähigkeiten könnten in diesem Bereich besonders wertvoll sein?</p>
                `,
                lisa: `
                    <p><strong>Liebe Frau Müller,</strong></p>
                    <p>ich spüre Ihre Leidenschaft sowohl für Ihren Beruf als auch für Ihre Familie - das ist ein Geschenk, auch wenn es sich gerade wie eine Last anfühlt. Ihre Sorge zeigt, wie wichtig Ihnen beide Lebensbereiche sind.</p>
                    <p><strong>Ihre besonderen Stärken:</strong> Sie haben bereits bewiesen, dass Sie in extremen Stresssituationen Leben retten können. Diese Entscheidungskraft und Prioritätensetzung sind Superkräfte, die wir auch für Ihr Privatleben nutzen können.</p>
                    <p><strong>Zum Nachdenken:</strong> Wenn Sie Ihre chirurgischen Fähigkeiten der Prioritätensetzung auf Ihr Familienleben anwenden würden - welche 2-3 Momente mit Ihren Kindern wären täglich "lebensrettend" wichtig?</p>
                `,
                marcus: `
                    <p><strong>Lieber Herr Hoffmann,</strong></p>
                    <p>Ihre Frage "War das schon alles?" ist nicht ein Zeichen von Undankbarkeit, sondern von Lebensdurst - das ist wundervoll! Mit 48 haben Sie noch Jahrzehnte voller Möglichkeiten vor sich.</p>
                    <p><strong>Was ich an Ihnen schätze:</strong> Sie haben die Ehrlichkeit, sich selbst kritisch zu hinterfragen. Ihre Ingenieurs-Denkweise kann Ihnen helfen, Ihr Leben wie ein spannendes Projekt neu zu "konstruieren".</p>
                    <p><strong>Erste Reflexion:</strong> Wenn Sie auf 80 zurückblicken würden - worauf wären Sie dann stolz, es in den nächsten 10 Jahren angegangen zu haben?</p>
                `,
                werner: `
                    <p><strong>Lieber Herr Schmidt,</strong></p>
                    <p>40 Jahre Führungsverantwortung - welch ein Geschenk an Erfahrung und Weisheit! Ihre Sorge vor dem Ruhestand zeigt, wie wichtig Ihnen Sinnhaftigkeit ist. Das wird Ihnen auch in dieser neuen Lebensphase helfen.</p>
                    <p><strong>Ihre wertvollen Ressourcen:</strong> Vier Jahrzehnte Menschenführung, Problemlösung und Verantwortung - diese Schätze verschwinden nicht mit der Rente, sondern können auf neue Weise wirken.</p>
                    <p><strong>Zum Erkunden:</strong> Welche Momente in Ihren 40 Berufsjahren haben Ihnen die größte Freude bereitet? Wie könnten ähnliche Erfahrungen auch außerhalb des klassischen Berufs möglich sein?</p>
                `
            };
            
            return responses[selectedClient] || responses.sarah;
        }

        function shareScreen() {
            alert('📺 Screen-Sharing simuliert: In einer echten Session würden Sie jetzt Ihren Bildschirm mit dem Klienten teilen, damit beide die KI-Responses sehen können.');
        }

        function exportSession() {
            const sessionData = {
                client: clients[selectedClient],
                step: currentStep,
                timestamp: new Date().toISOString(),
                duration: document.getElementById('sessionTimer').textContent
            };
            
            const blob = new Blob([JSON.stringify(sessionData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `coaching-session-${selectedClient}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function endSession() {
            if (confirm('Sind Sie sicher, dass Sie die Session beenden möchten?')) {
                if (sessionTimer) {
                    clearInterval(sessionTimer);
                }
                
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('clientSelection').style.display = 'block';
                
                // Reset
                selectedClient = null;
                currentStep = 1;
                document.getElementById('startButton').textContent = '🚀 Klient auswählen';
                document.getElementById('startButton').classList.remove('active');
                document.querySelectorAll('.client-card').forEach(card => card.classList.remove('selected'));
            }
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, app ready');
            const clientCards = document.querySelectorAll('.client-card');
            console.log(`Found client cards:`, clientCards.length);
            console.log('App initialized');
        });

        // Modal schließen bei Klick außerhalb
        window.onclick = function(event) {
            const modal = document.getElementById('promptModal');
            if (event.target === modal) {
                closePromptEditor();
            }
        }
    </script>
</body>
</html>